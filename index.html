<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Coconut Waste Recycling Co.</title>
<style>
:root {
  --accent: #2ebd8f;
  --dark: #0f172a;
  --light: #f8fafc;
  --text: #334155;
  --muted: #64748b;
  --shadow: 0 4px 20px rgba(0,0,0,0.08);
}
* { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  font-family: "Poppins", sans-serif;
  color: var(--text);
  background: #fff;
  line-height: 1.6;
}

/* HEADER */
header {
  background: #fff;
  box-shadow: 0 3px 15px rgba(0,0,0,0.05);
  position: sticky;
  top: 0;
  z-index: 10;
}
.nav {
  max-width: 1100px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
}
.logo {
  font-weight: 700;
  font-size: 1.4rem;
  color: var(--accent);
  letter-spacing: 0.5px;
}
.nav-links a {
  color: var(--dark);
  text-decoration: none;
  margin-left: 20px;
  font-weight: 500;
  transition: color .2s;
}
.nav-links a:hover { color: var(--accent); }

/* HERO */
.hero {
  text-align: center;
  padding: 90px 20px;
  background: linear-gradient(180deg,#ffffff,#e6fff2);
}
.hero h1 { font-size: 2.5rem; color: var(--accent); animation: fadeIn 1s ease-in-out; }
.hero p { max-width: 750px; margin: 12px auto; font-size: 1.1rem; color: var(--muted); animation: fadeIn 1.2s ease-in-out; }

/* ABOUT */
#about { background: var(--light); padding: 80px 20px; }
.about-container { max-width: 1100px; margin: 0 auto; }
.about-header h2 { color: var(--accent); font-size: 2.2rem; text-align: center; margin-bottom: 20px; }
.about-header p { color: var(--text); max-width: 900px; text-align: center; margin: 10px auto 25px; font-size: 1.05rem; line-height: 1.8; }

/* FOUNDER SECTION */
.founder-section { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 40px; margin-top: 40px; }
.founder-photo { width: 260px; height: 260px; border-radius: 50%; object-fit: cover; border: 5px solid var(--accent); box-shadow: var(--shadow); }
.founder-text { max-width: 600px; }
.founder-text h3 { color: var(--accent); font-size: 1.6rem; }
.founder-text p { color: var(--muted); margin-top: 8px; line-height: 1.8; }

/* TEAM */
.team-section { text-align: center; margin-top: 70px; }
.team-section h3 { color: var(--accent); font-size: 1.8rem; }
.team-section p { max-width: 700px; margin: 10px auto 30px; color: var(--muted); }
.team-grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap: 25px; }
.team-member { background: #fff; border-radius: 12px; box-shadow: var(--shadow); padding: 20px; transition: transform .3s; }
.team-member:hover { transform: translateY(-6px); }
.team-member img { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid var(--accent); margin-bottom: 10px; }
.team-member h4 { color: var(--dark); margin-bottom: 4px; }
.team-member p { color: var(--muted); font-size: 0.9rem; }

/* PRODUCTS */
#products { padding: 80px 20px; background: #fff; }
#products h2 { text-align: center; color: var(--accent); font-size: 2rem; }
.product-grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(250px,1fr)); gap: 20px; margin-top: 40px; }
.product-card { background: #fff; border-radius: 12px; box-shadow: var(--shadow); padding: 16px; text-align: center; transition: transform .3s; }
.product-card:hover { transform: translateY(-6px); cursor: default; }
.product-card img { width: 100%; height: 170px; border-radius: 10px; object-fit: cover; }
.price { color: var(--accent); font-weight: 700; }
.cart-container { border-top: 2px solid #e2e8f0; margin-top: 50px; padding-top: 20px; }
.cart-total { text-align: right; font-weight: 700; color: var(--accent); }

/* CART */
.cart-table { width: 100%; border-collapse: collapse; margin-bottom: 12px; }
.cart-table th, .cart-table td { padding: 10px; text-align: left; border-bottom: 1px solid #eef2f7; }
.cart-item-img { width: 56px; height: 40px; object-fit: cover; border-radius: 8px; margin-right: 10px; }

/* small UI */
.add-btn { background: var(--accent); color: #fff; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-weight: 600; }
.remove-btn { background: transparent; color: #ef4444; border: none; padding: 6px 8px; cursor: pointer; font-weight: 700; }
.qty-btn { background: #f1f5f9; border: none; padding: 6px 8px; cursor: pointer; margin: 0 6px; border-radius: 6px; }

/* IMPACT */
#impact { background: linear-gradient(180deg,#e8fff5,#fff); text-align: center; padding: 80px 20px; }
#impact h2 { color: var(--accent); font-size: 2rem; }
.impact-stats { display: flex; flex-wrap: wrap; justify-content: center; gap: 40px; margin-top: 40px; }
.stat { background: #fff; border-radius: 12px; box-shadow: var(--shadow); width: 220px; padding: 20px; }
.stat h3 { color: var(--accent); font-size: 2rem; }
.stat p { color: var(--muted); }
/* Make modal content scrollable when it's taller than the viewport */
.modal {
  /* allow the overlay to scroll if modal content is taller than viewport */
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}

/* Limit modal height and enable vertical scrolling inside it */
.modal-content {
  max-height: 90vh;           /* don't exceed viewport height */
  overflow-y: auto;          /* enable vertical scroll inside modal */
  -webkit-overflow-scrolling: touch; /* smooth scrolling on iOS */
  /* optional padding adjustment so content doesn't stick to edges on small screens */
  padding-bottom: 24px;
}

/* CONTACT + FOOTER */
#contact { padding: 80px 20px; text-align: center; }
#contact h2 { color: var(--accent); margin-bottom: 10px; }
#contact p { color: var(--muted); }
footer { background: var(--dark); color: #dbe6ff; text-align: center; padding: 40px 20px; }
footer .ql-list a { color: #bfc9d8; text-decoration: none; margin: 0 10px; }
footer .ql-list a:hover { color: #fff; }
.footer-bottom { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; color: #aab6d6; font-size: .9rem; }

/* MODAL */
.modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 99; }
.modal-content { background: #fff; border-radius: 16px; padding: 24px; max-width: 760px; width: 94%; box-shadow: var(--shadow); position: relative; animation: fadeIn .3s ease; }
.modal-content img { width: 100%; border-radius: 10px; height: 240px; object-fit: cover; }
.modal-content h3 { color: var(--accent); margin-top: 10px; }
.close-btn { position: absolute; top: 10px; right: 16px; font-size: 1.6rem; border: none; background: none; color: var(--muted); cursor: pointer; }

/* small form styles */
.field { margin-bottom:8px; display:flex; gap:8px; align-items:center; }
.field label { width:120px; color:var(--muted); font-size:0.95rem; }
.field input, .field textarea, .field select { flex:1; padding:8px 10px; border-radius:8px; border:1px solid #e6e9ee; font-size:0.95rem; }
.field textarea { min-height:64px; resize:vertical; }

/* responsive tweaks */
@media(max-width:768px){
  .founder-section{flex-direction:column;text-align:center;}
  .nav-links{display:none;}
  .field { flex-direction:column; align-items:flex-start; }
  .field label { width:100%; margin-bottom:6px; }
}
@keyframes fadeIn { from {opacity:0; transform:scale(.95);} to {opacity:1; transform:scale(1);} }
</style>
</head>
<body>

<header>
  <div class="nav">
    <div class="logo">Coconut Waste Recycling Co.</div>
    <div class="nav-links">
      <a href="#about">About</a>
      <a href="#products">Products</a>
      <a href="#impact">Impact</a>
      <a href="#contact">Contact</a>
    </div>
  </div>
</header>

<section class="hero">
  <h1>Transforming Coconut Waste Into Green Wealth</h1>
  <p>We recycle coconut husks, shells, and coir into sustainable, eco-friendly products ‚Äî empowering rural farmers and building a cleaner planet.</p>
</section>

<!-- PRODUCTS -->
<section id="products">
  <h2>Our Eco Products</h2>
  <div class="product-grid" id="productGrid"></div>

  <div style="text-align:center; margin-top:24px;">
    <button class="add-btn" onclick="toggleCart()">üõí View Cart</button>
  </div>

  <div class="cart-container" id="cartContainer" style="display:none;">
    <h3>üõç Your Cart</h3>
    <div id="cartTableContainer">
      <table class="cart-table" id="cartTable">
        <thead>
          <tr>
            <th>Item</th>
            <th>Price (‚Çπ)</th>
            <th>Qty</th>
            <th>Total (‚Çπ)</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="cartBody"></tbody>
      </table>
    </div>

    <div class="cart-summary">
      <p><strong>Subtotal:</strong> ‚Çπ<span id="cartSubtotal">0.00</span></p>
      <p><strong>GST (18%):</strong> ‚Çπ<span id="cartGST">0.00</span></p>
      <p class="final"><strong>Grand Total:</strong> ‚Çπ<span id="cartTotal">0.00</span></p>
      <div style="margin-top:12px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
        <button class="add-btn" onclick="showBill()">üßæ View Bill & Place Order</button>
        <button style="background:#f97316;color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer" onclick="clearCart()">Clear Cart</button>
      </div>
    </div>
  </div>
</section>

<!-- BILL MODAL (UPI + COD + Delivery address) -->
<div class="modal" id="billModal" aria-hidden="true">
  <div class="modal-content" id="billContent" role="dialog" aria-modal="true">
    <button class="close-btn" onclick="closeBill()">√ó</button>
    <h2>Coconut Waste Recycling Co.</h2>
    <p>üå¥ Sustainable Products Invoice</p>
    <hr style="margin:10px 0;">
    <div id="billItems" style="margin-bottom:8px"></div>
    <hr style="margin:10px 0;">
    <p><strong>Subtotal:</strong> ‚Çπ<span id="billSubtotal"></span></p>
    <p><strong>GST (18%):</strong> ‚Çπ<span id="billGST"></span></p>
    <p><strong>Grand Total:</strong> ‚Çπ<span id="billGrand"></span></p>

    <hr style="margin:10px 0;">
    <div style="text-align:left; margin:8px 0;">
      <strong>Delivery details</strong>
      <div id="addressErrors" style="color:#ef4444;margin-top:8px;"></div>
      <div style="margin-top:10px">
        <div class="field"><label for="delName">Full name</label><input id="delName" placeholder="Recipient full name" /></div>
        <div class="field"><label for="delPhone">Phone</label><input id="delPhone" placeholder="10-digit mobile number" /></div>
        <div class="field"><label for="delAddress">Address</label><textarea id="delAddress" placeholder="House, street, locality"></textarea></div>
        <div class="field"><label for="delCity">City</label><input id="delCity" placeholder="City / Town" /></div>
        <div class="field"><label for="delState">State</label><input id="delState" placeholder="State" /></div>
        <div class="field"><label for="delPincode">Pincode</label><input id="delPincode" placeholder="Postal code" /></div>
        <div class="field"><label for="delLandmark">Landmark</label><input id="delLandmark" placeholder="Optional landmark" /></div>
        <div class="field"><label for="delNotes">Notes</label><textarea id="delNotes" placeholder="Delivery notes (optional)"></textarea></div>
      </div>
    </div>

    <hr style="margin:10px 0;">
    <div style="text-align:left; margin:8px 0;">
      <strong>Choose payment method:</strong>
      <div style="margin-top:8px;">
        <label><input type="radio" name="payMethod" value="upi" checked onchange="onPaymentMethodChange(event)"> UPI (GPay / PhonePe)</label><br>
        <label style="margin-top:6px;"><input type="radio" name="payMethod" value="cod" onchange="onPaymentMethodChange(event)"> Cash on Delivery (COD)</label>
      </div>
    </div>

    <div id="upiPanel" style="margin-top:12px;background:#f8fafc;padding:12px;border-radius:8px;border:1px solid #e6f3ea">
      <p style="margin:0 0 6px;"><strong>Pay via UPI to:</strong></p>
      <p style="margin:0 8px 8px;"><strong>Mobile / UPI number:</strong> <span id="upiNumber">+91-8639533425</span></p>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <button class="add-btn" onclick="copyToClipboard('+918639533425')">Copy number</button>
        <button class="add-btn" onclick="openUpiDeepLink()">Open UPI app</button>
        <span style="color:var(--muted);font-size:0.9rem">After paying, click "I have paid ‚Äî Confirm Payment".</span>
      </div>
    </div>

    <div id="codPanel" style="display:none;margin-top:12px;background:#fff6ee;padding:12px;border-radius:8px;border:1px solid #fbe6d0">
      <p style="margin:0;"><strong>Cash on Delivery selected.</strong> Please keep cash ready when the delivery arrives.</p>
    </div>

    <div style="margin-top:14px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
      <button id="confirmUpiBtn" class="add-btn" onclick="confirmUpiPayment()">I have paid ‚Äî Confirm Payment</button>
      <button id="confirmCodBtn" class="add-btn" style="background:#2b9f73;display:none" onclick="confirmCodOrder()">Place order (COD)</button>
      <button class="add-btn" onclick="closeBill()" style="background:#94a3b8">Close</button>
    </div>

    <p id="billNote" style="margin-top:8px;color:var(--muted);font-size:0.9rem;text-align:center"></p>
  </div>
</div>

<!-- ABOUT -->
<section id="about">
  <div class="about-container">
    <div class="about-header">
      <h2>About Us</h2>
      <p><strong>Coconut Waste Recycling Co.</strong> transforms discarded coconut waste into eco-products like cocopeat, coir fiber, compost, and activated carbon. We blend innovation with community empowerment to create a circular, sustainable future where nothing goes to waste.</p>
      <p>Our work empowers rural communities by turning waste into income opportunities, while promoting sustainability and reducing carbon footprint. We believe every coconut husk can be reborn into something valuable.</p>
    </div>

    <div class="founder-section">
      <img src="images/founder.jpg" class="founder-photo" alt="Founder" onerror="this.src='https://i.postimg.cc/6p3PgX35/Whats-App-Image-2025-11-11-at-3-20-04-PM.jpg'">
      <div class="founder-text">
        <h3>Meet the Founder ‚Äî VENNELA</h3>
        <p>vennala is an environmental entrepreneur who founded this venture to redefine waste management in India. His vision is to transform agricultural by-products into sustainable resources that protect the planet while strengthening communities.</p>
      </div>
    </div>

    <div class="team-section">
      <h3>Meet Our Team</h3>
      <p>Our passionate team of innovators, engineers, and environmentalists work together to bring eco-friendly solutions to life.</p>
      <div class="team-grid">
        <div class="team-member"><img src="images/founder.jpg" alt="VENNELA" onerror="this.src='https://i.postimg.cc/6p3PgX35/Whats-App-Image-2025-11-11-at-3-20-04-PM.jpg'"><h4>Ruthik</h4><p>Founder & CEO</p></div>
        <div class="team-member"><img src="images/member2.jpg" alt="Himalaya" onerror="this.src='https://i.postimg.cc/qM0VmSyG/Whats-App-Image-2025-11-11-at-3-20-04-PM-1.jpg'"><h4>Himalaya</h4><p>Head of Sustainability</p></div>
        <div class="team-member"><img src="images/member3.jpg" alt="Abhijith" onerror="this.src='https://i.postimg.cc/PqDw5CJn/Whats-App-Image-2025-11-11-at-3-20-05-PM.jpg'"><h4>abhijith</h4><p>Production Engineer</p></div>
        <div class="team-member"><img src="images/member4.jpg" alt="Ruthik" onerror="this.src='https://i.postimg.cc/WbmYh4Dz/Whats-App-Image-2025-10-25-at-9-31-07-PM.jpg'"><h4>vennala</h4><p>Marketing & Outreach</p></div>
      </div>
    </div>
  </div>
</section>

<!-- IMPACT -->
<section id="impact">
  <h2>Our Impact</h2>
  <div class="impact-stats">
    <div class="stat"><h3>10+ Tons</h3><p>Coconut Waste Recycled</p></div>
    <div class="stat"><h3>50+</h3><p>Farmers Empowered</p></div>
    <div class="stat"><h3>20+</h3><p>Eco Products Developed</p></div>
    <div class="stat"><h3>100%</h3><p>Eco-Friendly Operations</p></div>
  </div>
</section>

<!-- CONTACT -->
<section id="contact">
  <h2>Contact Us</h2>
  <p>üìû +91-8639533425 | üìß sairuthik31@gmail.com</p>
  <p>Based in India ‚Äî Turning Coconut Waste into Sustainable Wealth.</p>
</section>

<footer>
  <div class="ql-list">
    <a href="#about">About</a>
    <a href="#products">Products</a>
    <a href="#impact">Impact</a>
    <a href="#contact">Contact</a>
  </div>
  <div class="footer-bottom">
    ¬© <span id="year"></span> Coconut Waste Recycling Co. | Designed by Ruthik üå¥
  </div>
</footer>

<!-- PRODUCT DETAILS MODAL -->
<div class="modal" id="productModal" aria-hidden="true">
  <div class="modal-content" id="modalContent" role="dialog" aria-modal="true">
    <button class="close-btn" onclick="closeProductModal()">√ó</button>
    <div id="modalInner"></div>
  </div>
</div>

<script>
/* -------------------------
   Product data (detailed descriptions + usage)
   ------------------------- */
const products = [
  { id:1, name:"Cocopeat Block", price:299, img:"https://i.postimg.cc/y6pX71qk/OIP.jpg", short:"Compressed cocopeat block ‚Äî great water retention and aeration for potting and seed starting.", description:"Compressed cocopeat (coco coir) blocks produced from processed coconut husk dust. Lightweight, neutral pH, excellent water retention and aeration. A sustainable, peat-free growing medium alternative.", usage:["Soak block in water for 10‚Äì15 minutes until fully expanded.","Mix expanded cocopeat with garden soil or use as a potting substrate (30‚Äì70% mix ratios work well).","Ideal for seed germination, potting mix, and container gardening.","Use as a base for hydroponic systems and grow bags."] },
  { id:2, name:"Coir Fiber Bundle", price:199, img:"https://i.postimg.cc/xjpy9frX/OIP-1.jpg", short:"Long, strong coir fibers used in erosion control, crafts, and planter liners.", description:"Natural coir fiber extracted from coconut husks. Durable and resilient fibers ideal for horticultural and industrial uses ‚Äî erosion control mats, rope, fibre padding, and planter liners.", usage:["Use as basket or hanging planter liners to retain soil while allowing drainage.","Incorporate into mulch to reduce soil evaporation and control erosion.","Make ropes, mats, or craft items ‚Äî biodegradable and strong.","Mix into potting soil in small amounts to improve structure."] },
  { id:3, name:"Activated Carbon (Coconut Shell)", price:499, img:"https://i.postimg.cc/KcprmGX4/OIP-2.jpg", short:"Premium activated carbon for water filtration, odor control, and air purification.", description:"High-grade activated carbon made from coconut shell with excellent adsorption capacity. Suitable for household and small-scale filtration to remove chlorine, odors, and organic contaminants.", usage:["Put in water filter cartridges to remove chlorine and impurities.","Use in aquarium filters for clear water and odor control (change periodically).","Place sachets in refrigerators, shoes, or compost bins to neutralize odors.","Use in small-scale industrial or laboratory filtration where appropriate."] },
  { id:4, name:"Organic Compost", price:249, img:"https://i.postimg.cc/L4QBm9d5/OIP-3.jpg", short:"Nutrient-rich compost from coconut waste and green matter to enrich garden soil.", description:"Well-decomposed organic compost made from coconut waste blended with local green matter. Rich in humus and beneficial microbes ‚Äî improves soil structure and fertility.", usage:["Incorporate 2‚Äì4 inches into garden beds before planting to enrich soil.","Top-dress potted plants and vegetables to add nutrients.","Mix with other potting components (20‚Äì30%) for nutrient boost.","Use in landscaping and lawn renovation to improve soil health."] }
];

/* -------------------------
   Cart model & payment constants
   ------------------------- */
const CART_KEY = "cwr_cart_v1";
const TAX_RATE = 0.18;
const MERCHANT_UPI_NUMBER = '+918639533425'; // normalized for deep-link / copy
const MERCHANT_DISPLAY_NUMBER = '+91-8639533425';

function loadCart() { try { return JSON.parse(localStorage.getItem(CART_KEY)) || { items: {} }; } catch { return { items: {} }; } }
function saveCart(cart) { localStorage.setItem(CART_KEY, JSON.stringify(cart)); }

/* add to cart */
function addToCart(productId, qty=1) {
  const p = products.find(x=>x.id===Number(productId));
  if(!p){ showToast("Product not found"); return; }
  const cart = loadCart();
  const key = String(p.id);
  const current = cart.items[key] ? Number(cart.items[key].qty) : 0;
  cart.items[key] = { id:p.id, qty: current + Number(qty), price: p.price, name: p.name, img: p.img };
  saveCart(cart);
  renderCartUI();
  showToast(`${p.name} added to cart`);
}

/* set qty/remove/clear */
function setQty(productId, qty){ const cart=loadCart(); const key=String(productId); if(!cart.items[key]) return; qty=Number(qty); if(qty<=0){ delete cart.items[key]; } else { cart.items[key].qty = qty; } saveCart(cart); renderCartUI(); }
function removeCartItem(productId){ const cart=loadCart(); const key=String(productId); if(!cart.items[key]) return; const name=cart.items[key].name; delete cart.items[key]; saveCart(cart); renderCartUI(); showToast(`${name} removed`); }
function clearCart(){ saveCart({ items: {} }); renderCartUI(); showToast("Cart cleared"); }

function calculateTotalsObj(cart){ cart=cart||loadCart(); let subtotal=0; for(const k of Object.keys(cart.items||{})){ const it=cart.items[k]; subtotal += Number(it.price)*Number(it.qty); } subtotal = Math.round((subtotal+Number.EPSILON)*100)/100; const tax = Math.round((subtotal*TAX_RATE+Number.EPSILON)*100)/100; const grand = Math.round((subtotal+tax+Number.EPSILON)*100)/100; return { subtotal, tax, grand }; }

/* -------------------------
   UI: Products, cart, modal
   ------------------------- */
const productGrid = document.getElementById("productGrid");
function renderProducts(){ productGrid.innerHTML=""; products.forEach(p=>{ const card=document.createElement("div"); card.className="product-card"; card.innerHTML=`<img src="${p.img}" alt="${escapeHtml(p.name)}" onerror="this.src='https://i.postimg.cc/6p3PgX35/Whats-App-Image-2025-11-11-at-3-20-04-PM.jpg'"><h3>${escapeHtml(p.name)}</h3><p style="color:var(--muted);min-height:44px">${escapeHtml(p.short)}</p><p class="price">‚Çπ${Number(p.price).toFixed(2)}</p><div style="display:flex;gap:8px;justify-content:center;margin-top:10px"><button class="add-btn" onclick="addToCart(${p.id},1)">Add to Cart</button><button class="add-btn" style="background:#2b9f73" onclick="showProductModal(${p.id})">Details</button></div>`; productGrid.appendChild(card); }); }

function escapeHtml(s){ if(typeof s!=="string") return s; return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]); }

/* product modal */
const productModal = document.getElementById("productModal");
const modalInner = document.getElementById("modalInner");
function showProductModal(id){ const p=products.find(x=>x.id===Number(id)); if(!p) return; modalInner.innerHTML=`<img src="${p.img}" alt="${escapeHtml(p.name)}" onerror="this.src='https://i.postimg.cc/6p3PgX35/Whats-App-Image-2025-11-11-at-3-20-04-PM.jpg'"><h3>${escapeHtml(p.name)}</h3><p style="color:var(--muted);line-height:1.6;">${escapeHtml(p.description)}</p><h4 style="margin-top:12px;color:var(--accent)">How to use</h4><ul style="text-align:left;margin:8px 0 16px 18px;color:var(--text)">${p.usage.map(u=>`<li>${escapeHtml(u)}</li>`).join('')}</ul><p class="price">‚Çπ${Number(p.price).toFixed(2)}</p><div style="display:flex;gap:8px;justify-content:center;margin-top:10px"><button class="add-btn" onclick="addToCart(${p.id},1); closeProductModal();">Add to Cart</button><button class="add-btn" style="background:#94a3b8" onclick="closeProductModal()">Close</button></div>`; productModal.style.display="flex"; productModal.setAttribute("aria-hidden","false"); }
function closeProductModal(){ productModal.style.display="none"; productModal.setAttribute("aria-hidden","true"); }

/* cart UI */
function renderCartUI(){ const cart=loadCart(); const body=document.getElementById("cartBody"); const container=document.getElementById("cartContainer"); body.innerHTML=""; const keys=Object.keys(cart.items||{}); if(keys.length===0){ body.innerHTML=`<tr><td colspan="5" style="text-align:center;color:#6b7280;padding:20px">Your cart is empty.</td></tr>`; container.style.display="none"; updateCartTotals(); return; } container.style.display="block"; for(const k of keys){ const it=cart.items[k]; const total=Number(it.price)*Number(it.qty); const tr=document.createElement("tr"); tr.innerHTML=`<td style="display:flex;align-items:center"><img src="${it.img}" class="cart-item-img" onerror="this.src='https://i.postimg.cc/6p3PgX35/Whats-App-Image-2025-11-11-at-3-20-04-PM.jpg'"><div><div style="font-weight:600">${escapeHtml(it.name)}</div></div></td><td>‚Çπ${Number(it.price).toFixed(2)}</td><td><button class="qty-btn" onclick="decrementQty(${it.id})">-</button><input value="${it.qty}" oninput="qtyInput(event, ${it.id})" style="width:48px;text-align:center;border-radius:6px;border:1px solid #e5e7eb;padding:4px" /><button class="qty-btn" onclick="incrementQty(${it.id})">+</button></td><td>‚Çπ${Number(total).toFixed(2)}</td><td style="text-align:right"><button class="remove-btn" onclick="removeCartItem(${it.id})" title="Remove">‚úï</button></td>`; body.appendChild(tr); } updateCartTotals(); }

function incrementQty(id){ const cart=loadCart(); const k=String(id); if(!cart.items[k]) return; cart.items[k].qty = Number(cart.items[k].qty) + 1; saveCart(cart); renderCartUI(); }
function decrementQty(id){ const cart=loadCart(); const k=String(id); if(!cart.items[k]) return; cart.items[k].qty = Number(cart.items[k].qty) - 1; if(cart.items[k].qty<=0) delete cart.items[k]; saveCart(cart); renderCartUI(); }
let qtyTimers={};
function qtyInput(e,id){ const val=Math.max(0,Math.min(999,Number(e.target.value||0))); e.target.value=val; clearTimeout(qtyTimers[id]); qtyTimers[id]=setTimeout(()=> setQty(id,val),350); }
function toggleCart(){ const cont=document.getElementById("cartContainer"); cont.style.display=(cont.style.display==="block") ? "none":"block"; }
function updateCartTotals(){ const cart=loadCart(); const totals=calculateTotalsObj(cart); document.getElementById("cartSubtotal").textContent=totals.subtotal.toFixed(2); document.getElementById("cartGST").textContent=totals.tax.toFixed(2); document.getElementById("cartTotal").textContent=totals.grand.toFixed(2); }

/* -------------------------
   Payment & address handling
   ------------------------- */
function onPaymentMethodChange(e){ const val = e.target ? e.target.value : (e.value || 'upi'); document.getElementById("upiPanel").style.display = (val === 'upi') ? 'block' : 'none'; document.getElementById("codPanel").style.display = (val === 'cod') ? 'block' : 'none'; document.getElementById("confirmUpiBtn").style.display = (val === 'upi') ? 'inline-block' : 'none'; document.getElementById("confirmCodBtn").style.display = (val === 'cod') ? 'inline-block' : 'none'; document.getElementById("billNote").textContent=''; document.getElementById("addressErrors").textContent=''; }

function openUpiDeepLink(){ const totals = calculateTotalsObj(loadCart()); const payeeVpa = MERCHANT_UPI_NUMBER + '@upi'; const amount = totals.grand.toFixed(2); const upiUrl = `upi://pay?pa=${encodeURIComponent(payeeVpa)}&pn=${encodeURIComponent('Coconut Waste Recycling Co.')}&am=${encodeURIComponent(amount)}&cu=INR`; window.location.href = upiUrl; }

function copyToClipboard(text){ navigator.clipboard?.writeText(text).then(()=>{ showToast("Copied to clipboard"); }).catch(()=>{ const ta=document.createElement("textarea"); ta.value=text; document.body.appendChild(ta); ta.select(); try{ document.execCommand('copy'); showToast("Copied to clipboard"); }catch{ alert("Please copy: "+text); } ta.remove(); }); }

/* Validate delivery details - returns {ok:boolean, errors:[] } */
function collectAndValidateDelivery() {
  const name = (document.getElementById("delName").value || "").trim();
  const phone = (document.getElementById("delPhone").value || "").replace(/\s+/g, "");
  const address = (document.getElementById("delAddress").value || "").trim();
  const city = (document.getElementById("delCity").value || "").trim();
  const state = (document.getElementById("delState").value || "").trim();
  const pincode = (document.getElementById("delPincode").value || "").trim();
  const landmark = (document.getElementById("delLandmark").value || "").trim();
  const notes = (document.getElementById("delNotes").value || "").trim();

  const errors = [];
  if (!name) errors.push("Please enter recipient's full name.");
  if (!phone || !/^[6-9]\d{9}$/.test(phone)) errors.push("Please enter a valid 10-digit mobile number (start with 6-9).");
  if (!address) errors.push("Please enter the delivery address.");
  // pincode optional but if present validate 6 digits
  if (pincode && !/^\d{6}$/.test(pincode)) errors.push("Pincode must be 6 digits.");

  const delivery = { name, phone, address, city, state, pincode, landmark, notes };
  return { ok: errors.length === 0, errors, delivery };
}

/* show bill + prepare modal */
function showBill() {
  const cart = loadCart(); const keys = Object.keys(cart.items||{});
  if(keys.length===0){ showToast("Your cart is empty"); return; }
  const itemsDiv = document.getElementById("billItems"); itemsDiv.innerHTML="";
  let subtotal=0;
  for(const k of keys){ const it = cart.items[k]; const line = Number(it.price)*Number(it.qty); subtotal += line; const p = document.createElement("p"); p.textContent = `${it.name} √ó ${it.qty} = ‚Çπ${line.toFixed(2)}`; itemsDiv.appendChild(p); }
  const tax = Math.round((subtotal*TAX_RATE+Number.EPSILON)*100)/100;
  const grand = Math.round((subtotal+tax+Number.EPSILON)*100)/100;
  document.getElementById("billSubtotal").textContent = subtotal.toFixed(2);
  document.getElementById("billGST").textContent = tax.toFixed(2);
  document.getElementById("billGrand").textContent = grand.toFixed(2);
  document.getElementById("upiNumber").textContent = MERCHANT_DISPLAY_NUMBER;
  document.querySelectorAll('input[name="payMethod"]').forEach(i=>i.checked = (i.value==='upi'));
  document.getElementById("upiPanel").style.display='block';
  document.getElementById("codPanel").style.display='none';
  document.getElementById("confirmUpiBtn").style.display='inline-block';
  document.getElementById("confirmCodBtn").style.display='none';
  document.getElementById("billNote").textContent='';
  document.getElementById("addressErrors").textContent='';
  document.getElementById("billModal").style.display = "flex";
}

function closeBill(){ document.getElementById("billModal").style.display = "none"; }

/* On UPI confirm: validate address, save order as pending_payment with delivery details */
function confirmUpiPayment(){
  const ok = collectAndValidateDelivery();
  if(!ok.ok){ document.getElementById("addressErrors").textContent = ok.errors.join(" "); return; }
  const cart = loadCart(); const totals = calculateTotalsObj(cart);
  const orderId = 'ORD'+Date.now();
  const order = { id: orderId, items: Object.values(cart.items||{}), totals, paymentMethod:'UPI', upiNumber:MERCHANT_DISPLAY_NUMBER, delivery: ok.delivery, status:'pending_payment', createdAt:new Date().toISOString() };
  try { const pend = JSON.parse(localStorage.getItem('pending_orders')||'[]'); pend.push(order); localStorage.setItem('pending_orders', JSON.stringify(pend)); } catch { localStorage.setItem('pending_orders', JSON.stringify([order])); }
  document.getElementById("billNote").textContent = `Order ${orderId} placed (pending payment). Please keep transaction UTR/reference and notify merchant.`;
  showToast("Order recorded as pending. Please pay via UPI and notify merchant.");
  clearCart();
}

/* On COD confirm: validate address, save order as confirmed_cod with delivery details */
function confirmCodOrder(){
  const ok = collectAndValidateDelivery();
  if(!ok.ok){ document.getElementById("addressErrors").textContent = ok.errors.join(" "); return; }
  const cart = loadCart(); const totals = calculateTotalsObj(cart);
  const orderId = 'ORD'+Date.now();
  const order = { id: orderId, items: Object.values(cart.items||{}), totals, paymentMethod:'COD', delivery: ok.delivery, status:'confirmed_cod', createdAt:new Date().toISOString() };
  try { const ords = JSON.parse(localStorage.getItem('confirmed_orders')||'[]'); ords.push(order); localStorage.setItem('confirmed_orders', JSON.stringify(ords)); } catch { localStorage.setItem('confirmed_orders', JSON.stringify([order])); }
  alert(`‚úÖ Order ${orderId} confirmed (Cash on Delivery). Thank you!`);
  clearCart(); closeBill();
}

/* Toast */
function showToast(msg, ms=2000){ const t=document.createElement("div"); t.textContent=msg; Object.assign(t.style,{ position:"fixed", bottom:"20px", right:"20px", background:"#111827", color:"#fff", padding:"10px 14px", borderRadius:"8px", boxShadow:"0 6px 20px rgba(0,0,0,0.2)", zIndex:9999, opacity:0, transition:"opacity .18s ease"}); document.body.appendChild(t); requestAnimationFrame(()=> t.style.opacity=1); setTimeout(()=>{ t.style.opacity=0; setTimeout(()=> t.remove(),220); }, ms); }

/* init */
document.addEventListener("DOMContentLoaded", ()=>{ renderProducts(); renderCartUI(); document.getElementById("year").textContent = new Date().getFullYear(); });
window.addEventListener("click", (e)=>{ if(e.target===productModal) closeProductModal(); const billM = document.getElementById("billModal"); if(e.target===billM) closeBill(); });
window.addEventListener("storage", (e)=>{ if(e.key===CART_KEY) renderCartUI(); });

</script>

</body>
</html>

