<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>EcoCoco Value</title>
<style>
/* (Same CSS as before; kept concise here to save space) */
:root{--accent:#2ebd8f;--dark:#0f172a;--light:#f8fafc;--text:#334155;--muted:#64748b;--shadow:0 4px 20px rgba(0,0,0,0.08)}
*{box-sizing:border-box;margin:0;padding:0}html{scroll-behavior:smooth}body{font-family:Poppins,system-ui,Segoe UI,Arial;margin:0;color:var(--text);background:#fff;line-height:1.6}
/* header/hero/about/products/cart/modal styles (identical to previous working version) */
header{background:#fff;box-shadow:0 3px 15px rgba(0,0,0,0.05);position:sticky;top:0;z-index:10}
.nav{max-width:1100px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;padding:16px 20px}
.logo{font-weight:700;font-size:1.4rem;color:var(--accent);letter-spacing:0.5px}
.nav-links a{color:var(--dark);text-decoration:none;margin-left:20px;font-weight:500;transition:color .2s}
.nav-links a:hover{color:var(--accent)}
.hero{text-align:center;padding:90px 20px;background:linear-gradient(180deg,#ffffff,#e6fff2)}
.hero h1{font-size:2.5rem;color:var(--accent)}
.hero p{max-width:750px;margin:12px auto;color:var(--muted)}
#about{background:var(--light);padding:80px 20px}
.about-container{max-width:1100px;margin:0 auto}
.founder-section{display:flex;flex-wrap:wrap;justify-content:center;align-items:center;gap:40px;margin-top:40px}
.founder-photo{width:260px;height:260px;border-radius:50%;object-fit:cover;border:5px solid var(--accent);box-shadow:var(--shadow)}
.team-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:25px}
.product-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-top:40px;padding:0 20px}
.product-card{background:#fff;border-radius:12px;box-shadow:var(--shadow);padding:16px;text-align:center;transition:transform .3s}
.product-card:hover{transform:translateY(-6px)}
.product-card img{width:100%;height:170px;border-radius:10px;object-fit:cover}
.price{color:var(--accent);font-weight:700}
.cart-container{border-top:2px solid #e2e8f0;margin-top:50px;padding-top:20px}
.cart-table{width:100%;border-collapse:collapse;margin-bottom:12px}
.cart-table th,.cart-table td{padding:10px;text-align:left;border-bottom:1px solid #eef2f7}
.cart-item-img{width:56px;height:40px;object-fit:cover;border-radius:8px;margin-right:10px}
.add-btn{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
.remove-btn{background:transparent;color:#ef4444;border:none;padding:6px 8px;cursor:pointer;font-weight:700}
.qty-btn{background:#f1f5f9;border:none;padding:6px 8px;cursor:pointer;margin:0 6px;border-radius:6px}
.modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:99;overflow:auto;-webkit-overflow-scrolling:touch}
.modal-content{background:#fff;border-radius:16px;padding:24px;max-width:760px;width:94%;box-shadow:var(--shadow);position:relative;animation:fadeIn .3s ease;max-height:90vh;overflow-y:auto;-webkit-overflow-scrolling:touch}
.close-btn{position:absolute;top:10px;right:16px;font-size:1.6rem;border:none;background:none;color:var(--muted);cursor:pointer}
.field{margin-bottom:8px;display:flex;gap:8px;align-items:center}
.field label{width:120px;color:var(--muted);font-size:0.95rem}
.field input,.field textarea{flex:1;padding:8px 10px;border-radius:8px;border:1px solid #e6e9ee;font-size:0.95rem}
.field textarea{min-height:64px;resize:vertical}
@media(max-width:768px){.founder-section{flex-direction:column;text-align:center}.nav-links{display:none}.field{flex-direction:column;align-items:flex-start}.field label{width:100%;margin-bottom:6px}}@keyframes fadeIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
</style>
</head>
<body>

<header>
  <div class="nav">
    <div class="logo">EcoCoco Value.</div>
    <div class="nav-links">
      <a href="#about">About</a>
      <a href="#products">Products</a>
      <a href="#impact">Impact</a>
      <a href="#contact">Contact</a>
    </div>
  </div>
</header>

<section class="hero">
  <h1>Transforming Coconut Waste Into Green Wealth</h1>
  <p>We recycle coconut husks, shells, and coir into sustainable, eco-friendly products ‚Äî empowering rural farmers and building a cleaner planet.</p>
</section>

<section id="products">
  <h2 style="text-align:center;color:var(--accent);margin-top:16px">Our Eco Products</h2>
  <div class="product-grid" id="productGrid"></div>

  <div style="text-align:center;margin:18px 0;">
    <button class="add-btn" onclick="toggleCart()">üõí View Cart</button>
  </div>

  <div class="cart-container" id="cartContainer" style="display:none;">
    <h3>üõç Your Cart</h3>
    <div id="cartTableContainer">
      <table class="cart-table" id="cartTable">
        <thead><tr><th>Item</th><th>Price (‚Çπ)</th><th>Qty</th><th>Total (‚Çπ)</th><th></th></tr></thead>
        <tbody id="cartBody"></tbody>
      </table>
    </div>
    <div class="cart-summary" style="padding:0 20px 18px">
      <p><strong>Subtotal:</strong> ‚Çπ<span id="cartSubtotal">0.00</span></p>
      <p><strong>GST (18%):</strong> ‚Çπ<span id="cartGST">0.00</span></p>
      <p class="final"><strong>Grand Total:</strong> ‚Çπ<span id="cartTotal">0.00</span></p>
      <div style="margin-top:12px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
        <button class="add-btn" onclick="showBill()">üßæ View Bill & Place Order</button>
        <button style="background:#f97316;color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer" onclick="clearCart()">Clear Cart</button>
      </div>
    </div>
  </div>
</section>

<!-- BILL MODAL: includes delivery fields + payment + WhatsApp send -->
<div class="modal" id="billModal" aria-hidden="true">
  <div class="modal-content" id="billContent" role="dialog" aria-modal="true">
    <button class="close-btn" onclick="closeBill()">√ó</button>
    <h2>Coconut Waste Recycling Co.</h2>
    <p>üå¥ Sustainable Products Invoice</p>
    <hr style="margin:10px 0">
    <div id="billItems" style="margin-bottom:8px"></div>
    <hr style="margin:10px 0">
    <p><strong>Subtotal:</strong> ‚Çπ<span id="billSubtotal"></span></p>
    <p><strong>GST (18%):</strong> ‚Çπ<span id="billGST"></span></p>
    <p><strong>Grand Total:</strong> ‚Çπ<span id="billGrand"></span></p>

    <hr style="margin:10px 0">
    <div style="text-align:left;margin:6px 0;">
      <strong>Delivery details</strong>
      <div id="addressErrors" style="color:#ef4444;margin-top:8px"></div>
      <div style="margin-top:10px">
        <div class="field"><label for="delName">Full name</label><input id="delName" placeholder="Recipient full name"></div>
        <div class="field"><label for="delPhone">Phone</label><input id="delPhone" placeholder="10-digit mobile number"></div>
        <div class="field"><label for="delAddress">Address</label><textarea id="delAddress" placeholder="House, street, locality"></textarea></div>
        <div class="field"><label for="delCity">City</label><input id="delCity" placeholder="City / Town"></div>
        <div class="field"><label for="delState">State</label><input id="delState" placeholder="State"></div>
        <div class="field"><label for="delPincode">Pincode</label><input id="delPincode" placeholder="Postal code"></div>
        <div class="field"><label for="delLandmark">Landmark</label><input id="delLandmark" placeholder="Optional landmark"></div>
        <div class="field"><label for="delNotes">Notes</label><textarea id="delNotes" placeholder="Delivery notes (optional)"></textarea></div>
      </div>
    </div>

    <hr style="margin:10px 0">
    <div style="text-align:left;margin:8px 0">
      <strong>Choose payment method</strong>
      <div style="margin-top:8px">
        <label><input type="radio" name="payMethod" value="upi" checked onchange="onPaymentMethodChange(event)"> UPI (GPay / PhonePe)</label><br>
        <label style="margin-top:6px"><input type="radio" name="payMethod" value="cod" onchange="onPaymentMethodChange(event)"> Cash on Delivery (COD)</label>
      </div>
    </div>

    <div id="upiPanel" style="margin-top:12px;background:#f8fafc;padding:12px;border-radius:8px;border:1px solid #e6f3ea">
      <p style="margin:0 0 6px"><strong>Pay via UPI to:</strong></p>
      <p style="margin:0 8px 8px"><strong>Mobile / UPI number:</strong> <span id="upiNumber">+91-8639533425</span></p>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <button class="add-btn" onclick="copyToClipboard('+918639533425')">Copy number</button>
        <button class="add-btn" onclick="openUpiDeepLink()">Open UPI app</button>
        <span style="color:var(--muted);font-size:0.9rem">After paying, click "I have paid ‚Äî Confirm Payment".</span>
      </div>
    </div>

    <div id="codPanel" style="display:none;margin-top:12px;background:#fff6ee;padding:12px;border-radius:8px;border:1px solid #fbe6d0">
      <p style="margin:0"><strong>Cash on Delivery selected.</strong> Please keep cash ready when the delivery arrives.</p>
    </div>

    <div style="margin-top:14px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
      <button id="confirmUpiBtn" class="add-btn" onclick="confirmUpiPayment()">I have paid ‚Äî Confirm Payment</button>
      <button id="confirmCodBtn" class="add-btn" style="background:#2b9f73;display:none" onclick="confirmCodOrder()">Place order (COD)</button>
      <button class="add-btn" onclick="closeBill()" style="background:#94a3b8">Close</button>
    </div>

    <p id="billNote" style="margin-top:8px;color:var(--muted);font-size:0.9rem;text-align:center"></p>
  </div>
</div>

<!-- ABOUT / IMPACT / CONTACT / FOOTER (same content as before) -->
<!-- Replace your existing <section id="about">...</section> with this block -->
<section id="about" class="about-v2">
  <style>
    /* ABOUT V2: scoped styles (paste into page head if you prefer global) */
    .about-v2 {
      background: linear-gradient(180deg, #f9fffb 0%, #e6fff2 60%);
      padding: 80px 20px;
      color: #334155;
    }

    .about-v2 .about-container {
      max-width: 1100px;
      margin: 0 auto;
    }

    .about-v2 .about-header {
      text-align: center;
      margin-bottom: 40px;
      padding: 0 18px;
    }
    .about-v2 .about-header h2 {
      color: #22c18a;
      font-size: 34px;
      font-weight: 700;
      margin-bottom: 12px;
    }
    .about-v2 .about-header p {
      color: #475569;
      max-width: 920px;
      margin: 8px auto;
      line-height: 1.85;
      font-size: 15.5px;
    }

    /* Founder area: large circular photo + text */
    .about-v2 .founder-section {
      display: grid;
      grid-template-columns: 340px 1fr;
      gap: 36px;
      align-items: center;
      margin: 40px 0;
    }
    .about-v2 .founder-photo {
      width: 260px;
      height: 260px;
      border-radius: 50%;
      object-fit: cover;
      border: 6px solid #22c18a;
      box-shadow: 0 18px 40px rgba(34,193,138,0.12);
      display: block;
      margin: 0 auto;
      background: #fff;
    }
    .about-v2 .founder-text h3 {
      color: #0f7760;
      font-size: 22px;
      margin-bottom: 8px;
      font-weight: 700;
    }
    .about-v2 .founder-text p {
      color: #64748b;
      line-height: 1.8;
      font-size: 14.5px;
    }
    .about-v2 .founder-quote {
      margin-top: 12px;
      font-style: italic;
      color: #0f7760;
      background: rgba(34,193,138,0.04);
      padding: 10px 14px;
      border-radius: 10px;
      display: inline-block;
    }

    /* Team */
    .about-v2 .team-section {
      text-align: center;
      margin-top: 36px;
    }
    .about-v2 .team-section h3 {
      color: #0f7760;
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 10px;
    }
    .about-v2 .team-section p {
      color: #64748b;
      max-width: 820px;
      margin: 0 auto 22px;
      line-height: 1.7;
    }

    .about-v2 .team-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 18px;
      margin-top: 10px;
    }

    .about-v2 .team-member {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 12px 30px rgba(7,11,30,0.06);
      transition: transform .28s ease, box-shadow .28s ease;
      text-align: center;
    }
    .about-v2 .team-member:hover {
      transform: translateY(-8px);
      box-shadow: 0 22px 40px rgba(7,11,30,0.09);
    }
    .about-v2 .team-member img {
      width: 88px;
      height: 88px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid #22c18a;
      margin-bottom: 12px;
      display: inline-block;
      background: #fff;
    }
    .about-v2 .team-member h4 {
      margin: 6px 0 4px;
      font-size: 15px;
      color: #0f172a;
      font-weight: 700;
    }
    .about-v2 .team-member p {
      color: #94a3b8;
      font-size: 13px;
      margin: 0;
    }

    /* Impact mini-section (keeps your .stat style but provides spacing) */
    .about-v2 .impact-section {
      margin-top: 48px;
      text-align: center;
      padding-top: 30px;
    }
    .about-v2 .impact-section h3 {
      color: #0f7760;
      font-size: 22px;
      margin-bottom: 16px;
      font-weight: 700;
    }
    .about-v2 .impact-grid {
      display: flex;
      gap: 18px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 12px;
    }
    .about-v2 .stat {
      background: #fff;
      width: 170px;
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 12px 30px rgba(7,11,30,0.05);
    }
    .about-v2 .stat h3 { color: #22c18a; margin-bottom:6px; font-size:20px; }
    .about-v2 .stat p { color: #64748b; margin:0; font-size:13px; }

    /* CTA */
    .about-v2 .cta-section { margin-top: 28px; text-align:center; }
    .about-v2 .cta-section .btn { display:inline-block; margin:6px; padding:12px 18px; border-radius:10px; text-decoration:none; font-weight:700; color:#fff; background:#22c18a; box-shadow: 0 10px 30px rgba(34,193,138,0.12); }
    .about-v2 .cta-section .btn.secondary { background:#2563eb; }

    /* Responsive */
    @media (max-width: 960px) {
      .about-v2 .team-grid { grid-template-columns: repeat(2, 1fr); }
      .about-v2 .founder-section { grid-template-columns: 1fr; text-align: center; gap: 18px; }
      .about-v2 .founder-text { order: 2; }
      .about-v2 .founder-photo { margin: 0 auto; width: 200px; height: 200px; }
    }
    @media (max-width: 560px) {
      .about-v2 { padding: 48px 16px; }
      .about-v2 .team-grid { grid-template-columns: 1fr; gap: 14px; }
      .about-v2 .about-header h2 { font-size: 26px; }
    }
  </style>

  <div class="about-container">
    <div class="about-header">
      <h2>About Us</h2>
      <p><strong>Coconut Waste Recycling Co.</strong> transforms discarded coconut waste into eco-products like cocopeat, coir fiber, compost, and activated carbon. We blend innovation with community empowerment to create a circular, sustainable future where nothing goes to waste.</p>
      <p>Our work empowers rural communities by turning waste into income opportunities, while promoting sustainability and reducing carbon footprint. We believe every coconut husk can be reborn into something valuable.</p>
    </div>

    <div class="founder-section">
      <img src="images/founder.jpg"
           class="founder-photo"
           alt="Portrait of the founder"
           onerror="this.src='https://i.postimg.cc/6p3PgX35/Whats-App-Image-2025-11-11-at-3-20-04-PM.jpg'">

      <div class="founder-text">
        <h3>Meet the Founder ‚Äî VENNALA</h3>
        <p>Vennala is an environmental entrepreneur who founded this venture to redefine waste management in India. His vision is to transform agricultural by-products into sustainable resources that protect the planet while strengthening communities.</p>
        <p class="founder-quote">‚ÄúOur goal is to make every coconut count ‚Äî for farmers, for soil health, and for our future.‚Äù</p>
      </div>
    </div>

    <div class="team-section">
      <h3>Meet Our Team</h3>
      <p>Our passionate team of innovators, engineers, and environmentalists work together to bring eco-friendly solutions to life.</p>

      <div class="team-grid">
        <div class="team-member">
          <img src="images/founder.jpg" alt="Ruthik" onerror="this.src='https://i.postimg.cc/6p3PgX35/Whats-App-Image-2025-11-11-at-3-20-04-PM.jpg'">
          <h4>Ruthik</h4>
          <p>Founder & CEO</p>
        </div>

        <div class="team-member">
          <img src="images/member2.jpg" alt="Himalaya" onerror="this.src='https://i.postimg.cc/qM0VmSyG/Whats-App-Image-2025-11-11-at-3-20-04-PM-1.jpg'">
          <h4>Himalaya</h4>
          <p>Head of Sustainability</p>
        </div>

        <div class="team-member">
          <img src="images/member3.jpg" alt="abhijith" onerror="this.src='https://i.postimg.cc/PqDw5CJn/Whats-App-Image-2025-11-11-at-3-20-05-PM.jpg'">
          <h4>abhijith</h4>
          <p>Production Engineer</p>
        </div>

        <div class="team-member">
          <img src="images/member4.jpg" alt="vennala" onerror="this.src='https://i.postimg.cc/WbmYh4Dz/Whats-App-Image-2025-10-25-at-9-31-07-PM.jpg'">
          <h4>vennala</h4>
          <p>Marketing & Outreach</p>
        </div>
      </div>
    </div>

    <div class="impact-section">
      <h3>Our Impact</h3>
      <div class="impact-grid">
        <div class="stat"><h3>10+ Tons</h3><p>Waste recycled</p></div>
        <div class="stat"><h3>50+</h3><p>Farmers engaged</p></div>
        <div class="stat"><h3>20+</h3><p>Products developed</p></div>
        <div class="stat"><h3>100%</h3><p>Eco-friendly operations</p></div>
      </div>
    </div>

    <div class="cta-section">
      <p>Want to partner with us, place a bulk order, or learn how to use our products?</p>
      <a class="btn" href="#contact">Get in touch</a>
      <a class="btn secondary" href="mailto:sairuthik31@gmail.com">Email us</a>
    </div>
  </div>
</section>

<section id="contact" style="padding:30px 20px;text-align:center">
  <h2 style="color:var(--accent)">Contact Us</h2>
  <p style="color:var(--muted)">üìû +91-8639533425 | üìß sairuthik31@gmail.com</p>
</section>

<footer style="background:var(--dark);color:#dbe6ff;padding:28px;text-align:center">
  ¬© <span id="year"></span> Coconut Waste Recycling Co. | Designed by Ruthik üå¥
</footer>

<!-- Product details modal -->
<div class="modal" id="productModal" aria-hidden="true">
  <div class="modal-content" role="dialog" aria-modal="true">
    <button class="close-btn" onclick="closeProductModal()">√ó</button>
    <div id="modalInner"></div>
  </div>
</div>

<script>
/* -------------------------
   Data & constants
   ------------------------- */
const products = [
  { id:1, name:"Cocopeat Block", price:299, img:"https://i.postimg.cc/y6pX71qk/OIP.jpg", short:"Compressed cocopeat block ‚Äî great water retention and aeration.", description:"Compressed cocopeat blocks made from coconut coir.", usage:["Soak in water to expand","Mix with soil","Use for seed starting"] },
  { id:2, name:"Coir Fiber Bundle", price:199, img:"https://i.postimg.cc/xjpy9frX/OIP-1.jpg", short:"Long strong coir fibers", description:"Natural coir fibers for horticulture and crafts.", usage:["Use as planter liners","Make ropes and mats"] },
  { id:3, name:"Activated Carbon (Coconut Shell)", price:499, img:"https://i.postimg.cc/KcprmGX4/OIP-2.jpg", short:"Activated carbon for filtration", description:"High-grade activated carbon.", usage:["Use in water filters","Use in aquariums"] },
  { id:4, name:"Organic Compost", price:249, img:"https://i.postimg.cc/L4QBm9d5/OIP-3.jpg", short:"Nutrient-rich compost", description:"Compost made from coconut waste.", usage:["Mix into garden beds","Top-dress potted plants"] }
];

const CART_KEY = "cwr_cart_v1";
const TAX_RATE = 0.18;
const MERCHANT_DISPLAY_NUMBER = "+91-8639533425";
const WHATSAPP_NUMBER_INT = "918639533425"; // merchant whatsapp (international format w/o +)

/* -------------------------
   Storage helpers & cart
   ------------------------- */
function loadCart(){ try{return JSON.parse(localStorage.getItem(CART_KEY))||{items:{}}}catch{return {items:{}}} }
function saveCart(cart){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }
function addToCart(productId, qty=1){ const p = products.find(x=>x.id===Number(productId)); if(!p){ showToast("Product not found"); return; } const cart = loadCart(); const k = String(p.id); const cur = cart.items[k] ? Number(cart.items[k].qty):0; cart.items[k] = { id:p.id, qty: cur + Number(qty), price:p.price, name:p.name, img:p.img }; saveCart(cart); renderCartUI(); showToast(`${p.name} added to cart`); }
function setQty(productId, qty){ const cart = loadCart(); const k=String(productId); if(!cart.items[k]) return; qty=Number(qty); if(qty<=0){ delete cart.items[k]; } else cart.items[k].qty=qty; saveCart(cart); renderCartUI(); }
function removeCartItem(productId){ const cart = loadCart(); const k=String(productId); if(!cart.items[k]) return; const name = cart.items[k].name; delete cart.items[k]; saveCart(cart); renderCartUI(); showToast(`${name} removed`); }
function clearCart(){ saveCart({items:{}}); renderCartUI(); showToast("Cart cleared"); }
function calculateTotalsObj(cart){ cart = cart||loadCart(); let subtotal=0; for(const k of Object.keys(cart.items||{})){ const it=cart.items[k]; subtotal += Number(it.price)*Number(it.qty); } subtotal=Math.round((subtotal+Number.EPSILON)*100)/100; const tax=Math.round((subtotal*TAX_RATE+Number.EPSILON)*100)/100; const grand=Math.round((subtotal+tax+Number.EPSILON)*100)/100; return {subtotal,tax,grand}; }

/* -------------------------
   Render products & modals
   ------------------------- */
const productGrid = document.getElementById("productGrid");
function renderProducts(){ productGrid.innerHTML=""; products.forEach(p=>{ const card=document.createElement("div"); card.className="product-card"; card.innerHTML = `<img src="${p.img}" alt="${escapeHtml(p.name)}" onerror="this.src='https://i.postimg.cc/6p3PgX35/Whats-App-Image-2025-11-11-at-3-20-04-PM.jpg'"><h3>${escapeHtml(p.name)}</h3><p style="color:var(--muted);min-height:44px">${escapeHtml(p.short)}</p><p class="price">‚Çπ${Number(p.price).toFixed(2)}</p><div style="display:flex;gap:8px;justify-content:center;margin-top:10px"><button class="add-btn" onclick="addToCart(${p.id},1)">Add to Cart</button><button class="add-btn" style="background:#2b9f73" onclick="showProductModal(${p.id})">Details</button></div>`; productGrid.appendChild(card); }); }
function escapeHtml(s){ if(typeof s!=="string") return s; return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]); }
const productModal = document.getElementById("productModal"); const modalInner = document.getElementById("modalInner");
function showProductModal(id){ const p = products.find(x=>x.id===Number(id)); if(!p) return; modalInner.innerHTML = `<img src="${p.img}" alt="${escapeHtml(p.name)}" onerror="this.src='https://i.postimg.cc/6p3PgX35/Whats-App-Image-2025-11-11-at-3-20-04-PM.jpg'"><h3>${escapeHtml(p.name)}</h3><p style="color:var(--muted);line-height:1.6">${escapeHtml(p.description)}</p><h4 style="margin-top:12px;color:var(--accent)">How to use</h4><ul style="text-align:left;margin:8px 0 16px 18px;color:var(--text)">${p.usage.map(u=>`<li>${escapeHtml(u)}</li>`).join('')}</ul><p class="price">‚Çπ${Number(p.price).toFixed(2)}</p><div style="display:flex;gap:8px;justify-content:center;margin-top:10px"><button class="add-btn" onclick="addToCart(${p.id},1); closeProductModal();">Add to Cart</button><button class="add-btn" style="background:#94a3b8" onclick="closeProductModal()">Close</button></div>`; productModal.style.display="flex"; productModal.setAttribute("aria-hidden","false"); }
function closeProductModal(){ productModal.style.display="none"; productModal.setAttribute("aria-hidden","true"); }

/* -------------------------
   Cart UI
   ------------------------- */
function renderCartUI(){ const cart = loadCart(); const body = document.getElementById("cartBody"); const container = document.getElementById("cartContainer"); body.innerHTML=""; const keys = Object.keys(cart.items||{}); if(keys.length===0){ body.innerHTML = `<tr><td colspan="5" style="text-align:center;color:#6b7280;padding:20px">Your cart is empty.</td></tr>`; container.style.display="none"; updateCartTotals(); return; } container.style.display="block"; for(const k of keys){ const it=cart.items[k]; const total=Number(it.price)*Number(it.qty); const tr=document.createElement("tr"); tr.innerHTML = `<td style="display:flex;align-items:center"><img src="${it.img}" class="cart-item-img" onerror="this.src='https://i.postimg.cc/6p3PgX35/Whats-App-Image-2025-11-11-at-3-20-04-PM.jpg'"><div><div style="font-weight:600">${escapeHtml(it.name)}</div></div></td><td>‚Çπ${Number(it.price).toFixed(2)}</td><td><button class="qty-btn" onclick="decrementQty(${it.id})">-</button><input value="${it.qty}" oninput="qtyInput(event, ${it.id})" style="width:48px;text-align:center;border-radius:6px;border:1px solid #e5e7eb;padding:4px" /><button class="qty-btn" onclick="incrementQty(${it.id})">+</button></td><td>‚Çπ${Number(total).toFixed(2)}</td><td style="text-align:right"><button class="remove-btn" onclick="removeCartItem(${it.id})" title="Remove">‚úï</button></td>`; body.appendChild(tr); } updateCartTotals(); }
function incrementQty(id){ const cart=loadCart(); const k=String(id); if(!cart.items[k]) return; cart.items[k].qty = Number(cart.items[k].qty)+1; saveCart(cart); renderCartUI(); }
function decrementQty(id){ const cart=loadCart(); const k=String(id); if(!cart.items[k]) return; cart.items[k].qty = Number(cart.items[k].qty)-1; if(cart.items[k].qty<=0) delete cart.items[k]; saveCart(cart); renderCartUI(); }
let qtyTimers={}; function qtyInput(e,id){ const val=Math.max(0,Math.min(999,Number(e.target.value||0))); e.target.value=val; clearTimeout(qtyTimers[id]); qtyTimers[id]=setTimeout(()=> setQty(id,val),350); }
function toggleCart(){ const cont=document.getElementById("cartContainer"); cont.style.display = (cont.style.display==="block") ? "none":"block"; }
function updateCartTotals(){ const cart = loadCart(); const totals = calculateTotalsObj(cart); document.getElementById("cartSubtotal").textContent = totals.subtotal.toFixed(2); document.getElementById("cartGST").textContent = totals.tax.toFixed(2); document.getElementById("cartTotal").textContent = totals.grand.toFixed(2); }

/* -------------------------
   Delivery validation, payment & WhatsApp send
   ------------------------- */
function onPaymentMethodChange(e){ const val = e.target ? e.target.value : (e.value || 'upi'); document.getElementById("upiPanel").style.display = (val==='upi')?'block':'none'; document.getElementById("codPanel").style.display = (val==='cod')?'block':'none'; document.getElementById("confirmUpiBtn").style.display = (val==='upi')?'inline-block':'none'; document.getElementById("confirmCodBtn").style.display = (val==='cod')?'inline-block':'none'; document.getElementById("billNote").textContent=''; document.getElementById("addressErrors").textContent=''; }

function openUpiDeepLink(){ const totals = calculateTotalsObj(loadCart()); const payeeVpa = MERCHANT_DISPLAY_NUMBER.replace('+','') + '@upi'; const amount = totals.grand.toFixed(2); const upiUrl = `upi://pay?pa=${encodeURIComponent(payeeVpa)}&pn=${encodeURIComponent('Coconut Waste Recycling Co.')}&am=${encodeURIComponent(amount)}&cu=INR`; window.location.href = upiUrl; }
function copyToClipboard(text){ navigator.clipboard?.writeText(text).then(()=> showToast("Copied to clipboard")).catch(()=>{ const ta=document.createElement("textarea"); ta.value=text; document.body.appendChild(ta); ta.select(); try{ document.execCommand('copy'); showToast("Copied to clipboard"); }catch{ alert("Please copy: "+text);} ta.remove(); }); }

function collectAndValidateDelivery(){ const name=(document.getElementById("delName").value||"").trim(); const phone=(document.getElementById("delPhone").value||"").replace(/\s+/g,""); const address=(document.getElementById("delAddress").value||"").trim(); const city=(document.getElementById("delCity").value||"").trim(); const state=(document.getElementById("delState").value||"").trim(); const pincode=(document.getElementById("delPincode").value||"").trim(); const landmark=(document.getElementById("delLandmark").value||"").trim(); const notes=(document.getElementById("delNotes").value||"").trim(); const errors=[]; if(!name) errors.push("Please enter recipient's full name."); if(!phone || !/^[6-9]\d{9}$/.test(phone)) errors.push("Please enter a valid 10-digit mobile number (start with 6-9)."); if(!address) errors.push("Please enter the delivery address."); if(pincode && !/^\d{6}$/.test(pincode)) errors.push("Pincode must be 6 digits."); return { ok: errors.length===0, errors, delivery: { name, phone, address, city, state, pincode, landmark, notes } }; }

function showBill(){ const cart = loadCart(); const keys = Object.keys(cart.items||{}); if(keys.length===0){ showToast("Your cart is empty"); return; } const itemsDiv=document.getElementById("billItems"); itemsDiv.innerHTML=""; let subtotal=0; for(const k of keys){ const it=cart.items[k]; const lineTotal=Number(it.price)*Number(it.qty); subtotal+=lineTotal; const p=document.createElement("p"); p.textContent = `${it.name} √ó ${it.qty} = ‚Çπ${lineTotal.toFixed(2)}`; itemsDiv.appendChild(p); } const tax=Math.round((subtotal*TAX_RATE+Number.EPSILON)*100)/100; const grand=Math.round((subtotal+tax+Number.EPSILON)*100)/100; document.getElementById("billSubtotal").textContent = subtotal.toFixed(2); document.getElementById("billGST").textContent = tax.toFixed(2); document.getElementById("billGrand").textContent = grand.toFixed(2); document.getElementById("upiNumber").textContent = MERCHANT_DISPLAY_NUMBER; document.querySelectorAll('input[name="payMethod"]').forEach(i=>i.checked = (i.value==='upi')); document.getElementById("upiPanel").style.display='block'; document.getElementById("codPanel").style.display='none'; document.getElementById("confirmUpiBtn").style.display='inline-block'; document.getElementById("confirmCodBtn").style.display='none'; document.getElementById("billNote").textContent=''; document.getElementById("addressErrors").textContent=''; document.getElementById("billModal").style.display="flex"; }

function closeBill(){ document.getElementById("billModal").style.display="none"; }

/* WhatsApp helper: build message and open wa.me (fallback copy) */
function sendOrderToWhatsApp(order){
  const itemsText = (order.items||[]).map(it=>`‚Ä¢ ${it.name} x${it.qty} = ‚Çπ${(Number(it.price)*Number(it.qty)).toFixed(2)}`).join("\n");
  const d = order.delivery||{};
  const deliveryText = [`Name: ${d.name||"-"}`, `Phone: ${d.phone||"-"}`, `Address: ${d.address||"-"}`, `City: ${d.city||"-"}`, `State: ${d.state||"-"}`, `Pincode: ${d.pincode||"-"}`, d.landmark?`Landmark: ${d.landmark}`:null, d.notes?`Notes: ${d.notes}`:null].filter(Boolean).join("\n");
  const totals = order.totals||{};
  const totalsText = `Subtotal: ‚Çπ${(totals.subtotal||0).toFixed(2)}\nGST: ‚Çπ${(totals.tax||0).toFixed(2)}\nGrand Total: ‚Çπ${(totals.grand||0).toFixed(2)}`;
  const msg = [
    `üõí *New Order Received*`,
    `Order ID: ${order.id}`,
    ``,
    `*Items:*`,
    itemsText,
    ``,
    `*Payment:* ${order.paymentMethod||'-'}`,
    order.paymentMethod==='UPI' && order.upiNumber?`UPI: ${order.upiNumber}`:'',
    ``,
    `*Delivery Details:*`,
    deliveryText,
    ``,
    `*Totals:*`,
    totalsText,
    ``,
    `Placed at: ${new Date(order.createdAt||Date.now()).toLocaleString()}`,
    ``,
    `Please confirm.`
  ].filter(Boolean).join("\n");
  const encoded = encodeURIComponent(msg);
  const waLink = `https://wa.me/${WHATSAPP_NUMBER_INT}?text=${encoded}`;
  const win = window.open(waLink, "_blank");
  if(win){ try{ win.focus(); }catch(e){} } else { copyToClipboard(msg); showToast("WhatsApp blocked. Message copied to clipboard ‚Äî paste to WhatsApp to send."); }
}

/* confirm flows (UPI pending & COD confirmed) */
function confirmUpiPayment(){
  const ok = collectAndValidateDelivery(); if(!ok.ok){ document.getElementById("addressErrors").textContent = ok.errors.join(" "); return; }
  const cart = loadCart(); const totals = calculateTotalsObj(cart); const orderId = 'ORD'+Date.now();
  const order = { id:orderId, items: Object.values(cart.items||{}), totals, paymentMethod:'UPI', upiNumber: MERCHANT_DISPLAY_NUMBER, delivery: ok.delivery, status:'pending_payment', createdAt: new Date().toISOString() };
  try{ const pend = JSON.parse(localStorage.getItem('pending_orders')||'[]'); pend.push(order); localStorage.setItem('pending_orders', JSON.stringify(pend)); }catch{ localStorage.setItem('pending_orders', JSON.stringify([order])); }
  // Open WhatsApp with prefilled message
  sendOrderToWhatsApp(order);
  document.getElementById("billNote").textContent = `Order ${orderId} placed (pending payment). WhatsApp opened to notify merchant.`;
  showToast("Order recorded as pending and WhatsApp opened for notification.");
  clearCart();
}

function confirmCodOrder(){
  const ok = collectAndValidateDelivery(); if(!ok.ok){ document.getElementById("addressErrors").textContent = ok.errors.join(" "); return; }
  const cart = loadCart(); const totals = calculateTotalsObj(cart); const orderId = 'ORD'+Date.now();
  const order = { id:orderId, items: Object.values(cart.items||{}), totals, paymentMethod:'COD', delivery: ok.delivery, status:'confirmed_cod', createdAt: new Date().toISOString() };
  try{ const ords = JSON.parse(localStorage.getItem('confirmed_orders')||'[]'); ords.push(order); localStorage.setItem('confirmed_orders', JSON.stringify(ords)); }catch{ localStorage.setItem('confirmed_orders', JSON.stringify([order])); }
  // Notify merchant via WhatsApp
  sendOrderToWhatsApp(order);
  alert(`‚úÖ Order ${orderId} confirmed (Cash on Delivery). WhatsApp opened to notify merchant.`);
  clearCart(); closeBill();
}

/* Toast + init */
function showToast(msg, ms=2000){ const t=document.createElement("div"); t.textContent=msg; Object.assign(t.style,{position:"fixed",bottom:"20px",right:"20px",background:"#111827",color:"#fff",padding:"10px 14px",borderRadius:"8px",boxShadow:"0 6px 20px rgba(0,0,0,0.2)",zIndex:9999,opacity:0,transition:"opacity .18s ease"}); document.body.appendChild(t); requestAnimationFrame(()=> t.style.opacity=1); setTimeout(()=>{ t.style.opacity=0; setTimeout(()=> t.remove(),220); }, ms); }

document.addEventListener("DOMContentLoaded", ()=>{ renderProducts(); renderCartUI(); document.getElementById("year").textContent = new Date().getFullYear(); });
window.addEventListener("click", (e)=>{ if(e.target===productModal) closeProductModal(); const billM = document.getElementById("billModal"); if(e.target===billM) closeBill(); });
window.addEventListener("storage", (e)=>{ if(e.key===CART_KEY) renderCartUI(); });

</script>
</body>
</html>
